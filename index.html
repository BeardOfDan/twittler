<!DOCTYPE html>
<html>

<head>
  <script src="jquery.js"></script>
  <script src="data_generator.js"></script>

  <!-- The CSS is below the JS because it works on what is created by the JS,
    allowing the user to see something on the screen sooner -->
  <link rel="stylesheet" href="main.css">
</head>

<body>
  <div>
    <pre id="head"></pre>
  </div>
  <!-- <pre><button id="home">Home</button> | <button id="shawndrost">shawndrost</button> | <button id="sharksforcheap">sharksforcheap</button> | <button>mracus</button> | <button>douglascalhoun</button> | <span id="newTweets"></span></pre>
  </div> -->

  <div id="main"></div>
  <script>
    $(document).ready(function () {

      let userButtons = [];
      for (let i = 0; i < users.length; i++) {
        const thisUser = users[i];
        const button = $(`<button id="${thisUser}">${thisUser}</button>`);
        userButtons.push(button);
      }

      let $heading = $("<button id='home'>home</button>");
      $("#head").append($heading);

      for (let i = 0; i < userButtons.length; i++) {
        $("#head").append(" | ");
        $("#head").append(userButtons[i]);
      }

      // $("#head").append(" | ");
      // $("#head").append($("<span id='newTweets'>No New Tweets</span>"));

      // var $body = $('body');
      var $body = $("#main");
      $body.html('');

      let mode = { "user": "home" }; // home is the default 'user'
      // if it is to display a particular user only, then set the mode to that particular user

      const displayHome = function () {
        $body.html('');
        for (let i = 0; i < streams.home.length; i++) {
          let tweet = streams.home[i];
          var $tweet = $('<div class="tweet"></div>');

          let $userName = $(`<span class="userName"><a href="#" onclick="userClicked(this)" class="userLink">@${tweet.user}</a> 路 </span>`);
          $userName.appendTo($tweet);

          let $timestamp = $(`<small class='timestamp'>${tweet.created_at.toString()}</small>`);
          $timestamp.appendTo($tweet);

          let $message = $(`<br><br><span class="message">${tweet.message}</span>`);
          $message.appendTo($tweet);

          $tweet.prependTo($body); // put newest at the top
        }
      };

      const displayUser = function (user) {
        $body.html('');
        const thisUser = streams.users[user];
        for (let i = 0; i < thisUser.length; i++) {
          let tweet = thisUser[i];
          var $tweet = $('<div class="tweet"></div>');

          let $userName = $(`<span class="userName"><a href="#" onclick="userClicked(this)" class="userLink">@${tweet.user}</a> 路 </span>`);
          $userName.appendTo($tweet);

          let $timestamp = $(`<small class='timestamp'>${tweet.created_at.toString()}</small>`);
          $timestamp.appendTo($tweet);

          let $message = $(`<br><br><span class="message">${tweet.message}</span>`);
          $message.appendTo($tweet);

          $tweet.prependTo($body); // put newest at the top
        }
      }

      // button event handlers
      $("#home").on("click", function () {
        displayHome();
        $("#home").css("background-color", "inherit");

        // since currently viewing home, all tweets will be shown, therefore there are no longer new tweets
        for (let i = 0; i < users.length; i++) {
          $(`#${users[i]}`).css("background-color", "inherit");
        }

      });
      // listeners for each of the user buttons
      for (let i = 0; i < users.length; i++) {
        const thisUser = users[i];

        $(`#${thisUser}`).on("click", function () {
          displayUser(thisUser);
          $(`#${thisUser}`).css("background-color", "white");

          // check if no other users have a new tweet
          let homeClear = true;
          for (let i = 0; i < users.length; i++) {
            const color = $(`#${users[i]}`).css("background-color");
            if (color.toString() === "rgb(255, 165, 0)") { // orange
              homeClear = false;
              break;
            }
          }

          if (homeClear) {
            $("#home").css("background-color", "inherit");
          }

        });
      }

      // when someone clicks on a user's name
      userClicked = function (el) {
        const thisUser = el.innerText.slice(1);

        $body.empty();
        displayUser(thisUser);

        mode.user = thisUser;
        console.log(mode.user);
      };

      const hashTagClicked = function (el) {
        // TODO: add functionality to display all tweets with the same hashtag
      }

      // mutates the DOM body
      const presentTweet = function (tweet) {
        var $tweet = $('<div class="tweet"></div>');

        const $userName = $(`<span class="userName"><a href="#" onclick="userClicked(this)" class="userLink">@${tweet.user}</a> 路 </span>`);
        $userName.appendTo($tweet);

        const $timestamp = $(`<small class='timestamp'>${tweet.created_at.toString()}</small>`);
        $timestamp.appendTo($tweet);


        const octothorpePosition = tweet.message.indexOf("#");
        if (octothorpePosition > 0) {
          const message = tweet.message.slice(0, octothorpePosition);
          const hashTag = tweet.message.slice(octothorpePosition);

          const $message = $(`<br><br><span class="message">${message}</span><a href="#" class="hashTag">${hashTag}</a>`);
          $message.appendTo($tweet);
        } else {
          const $message = $(`<br><br><span class="message">${tweet.message}</span>`);
          $message.appendTo($tweet);
        }

        $tweet.prependTo($body); // displays the newest at the top
      };


      // var index = streams.home.length - 1;
      // while (index >= 0) {
      //   var tweet = streams.home[index];
      //   var $tweet = $('<div class="tweet"></div>');

      //   let $userName = $(`<span class="userName"><a href="#" onclick="userClicked(this)" class="userLink">@${tweet.user}</a> 路 </span>`);
      //   $userName.appendTo($tweet);

      //   let $timestamp = $(`<small class='timestamp'>${tweet.created_at.toString()}</small>`);
      //   $timestamp.appendTo($tweet);


      //   // use string.indexOf to find octothorpe #
      //   // check if unique or multiple
      //   // then use that index, and string.slice, to find what the hashtag is
      //   // then make it its own thing, in a span called tags, with a blue/link color


      //   let $message = $(`<br><br><span class="message">${tweet.message}</span>`);
      //   $message.appendTo($tweet);

      //   $tweet.appendTo($body);
      //   index -= 1;
      // }

      displayHome();

      // setInterval ?every 5 seconds?
      // update the tweets list (add any new tweets)
      // update the timeStamp (for a human readable format)
      //


      // a.push = function(x){
      //   console.log('added: ',x,', length changed: ',(this.length+1));
      //   this[this.length]=x
      // }

      // streams.home.push = function (x) {
      //   this[this.length] = x

      //   // if (mode.user === 'home') {
      //   //   presentTweet(x);
      //   // }
      //   // displayHome();
      // }

      // shawndrost = [];
      // streams.users.sharksforcheap = [];
      // streams.users.mracus = [];
      // streams.users.douglascalhoun = [];
      // window.users = Object.keys(streams.users);

      // for (let user in users) {
      //   user.push = function (tweet) {
      //     this[this.length] = tweet;

      //     // console.log("mu:", mode.user, "   | u:", user);

      //     // if (mode.user === user) {
      //     //   presentTweet(tweet);
      //     // }

      //   }
      // }

      // $(streams.home).change(function () {
      //   displayHome();
      //   console.log("asdfasdfaasdf");
      // });

      // generateRandomTweet()
      // setInterval(generateRandomTweet(), 1500);
      // const intervalID = setInterval(function () { generateRandomTweet(); console.log(streams.home.length) }, 10000);
      // const intervalID = setInterval(generateRandomTweet, 3000);



      // const addTweetIntervalID = setInterval(generateRandomTweet, 5000);

      // const addTweetIntervalID = setInterval(function () {
      //   var tweet = {};
      //   tweet.user = randomElement(users);

      //   $(`#${tweet.user}`).css("background-color", "orange");

      //   tweet.message = randomMessage();
      //   tweet.created_at = new Date();
      //   addTweet(tweet);

      //   // generateRandomTweet();
      //   // $(`#${newUser}`).css("background-color", "orange");
      //   $("#home").css("background-color", "orange");
      // }, 3000);

      // const updateDisplayIntervalID = setInterval(function () {
      //   console.log(streams.home.length);
      // }, 2000);



      // const updateDisplayIntervalID = setInterval(function () {
      //   const mu = mode.user;
      //   console.log("updating", mu);
      //   if (mu === 'home') {
      //     displayHome();
      //   } else {
      //     displayUser(mu);
      //   }
      // }, 5000);


    });
  </script>
</body>

</html>
